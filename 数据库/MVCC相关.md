## 隐藏列

- innodb中，数据表除了行号列意外，还会有两个隐藏列，其中一个是trx_id, 另一个是 roll_pointer，分别代表版本号和回滚指针，由回滚指针寻址一行数据发生了怎么样的变化，版本号可以知道是那个事务修改的。

<img src="C:\Users\wangkai3\AppData\Roaming\Typora\typora-user-images\image-20200827234737646.png" alt="image-20200827234737646" style="zoom: 50%;" />

- 事务的可见性是通过undo log实现得



## 为什么不加间隙锁的情况下，MVCC可重复读会产生幻读现象?

- 对于会对数据修改的操作(update、insert、delete)都是采用当前读的模式。
- **在执行这几个操作时会读取最新的版本号记录，写操作后把版本号改为了当前事务的版本号，所以即使是别的事务提交的数据也可以查询到**。
- 假设要update一条记录，但是在另一个事务中已经delete掉这条数据并且commit了，如果update就会产生冲突**，所以在update的时候需要知道最新的数据**。也正是因为这样所以才导致幻读。

- 如果想要在可重复读机制中查询最新的数据，可以通过加锁查询的方式，进入“当前读”