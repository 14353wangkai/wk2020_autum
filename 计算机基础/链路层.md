## ARP解析过程

https://zhuanlan.zhihu.com/p/28771785

- 通过广播向所有可达的ip发送arp报文
- 只有ip对应的mac作出响应
- 然后发出广播的主机将该mac地址写入缓存

## 链路层是否可靠？

- 数据链路层的差错控制：仅仅提供比特检验，不提供乱序，丢包，和重复检验。
  - 收到的帧并没有出现比特差错，只实现无比特差错传输，不提供可靠传输 
  -  因特网广泛使用的数据链路层协议都不适用确认和重传机制，即不要求数据链路层向上层提供可靠传输的服务(因为这要付出的代价太高，不合算)。如果在数据链路层传输数据时除了差错并且需要进行改正，那么改正差错的任务就由上层协议(如，运输层TCP协议)来完成。实验证明，这样可以提高通信效率。

### **差错检测**

- **传输差错：可分为两大类，一类就是最基本的比特差错，另一类就是收到的帧并没有出现比特错误，但却出现了帧丢失、帧重复或帧失序。**
- **比特差错：**就是比特在传输过程中可能会产生差错，即1可能会变成0，0可能会变成1。**比特差错是传输差错中的一种。**





## 旧版复制功能：SYNC

- redis的复制功能分为同步和命令传播
  - 同步操作用于从服务器的数据状态更新至住服务器当前所处的数据状态
    - 全部复制
      - bgsave：生成一个rdb，并用一个缓冲区
      - 将rdb发送给服务器
    - 命令传播
      - 用于在主服务器的数据库状态被修改，导致主从服务器的数据库状态不一致，让主从服务器的数据库重新回到一致
- 旧版本在掉线之后，需要从头同步



## 新版本复制功能：PSYNC

- 完整重同步用于处理初次复制的情况，与sync一样
- 复制偏移量+复制命令缓存+运行服务id
- 部分重同步用于处理掉线后的情况，当从服务器掉线后，重新连接主服务器时，如果条件允许，主服务器可以**将主从服务器连接断开期间执行的写命令**发送
  - 如何实现部分重同步？偏移量
    - 主服务器每次向从服务器传播N个字节的数据时，在偏移量上+N
    - 从服务器每次收到主服务器传来的N个字节数据的时候，在**复制偏移量**上+N
    - 通过对比偏移量就可以知道是否处于一致状态
- 断网检查：replconf ack
  - 从服务器主动给主服务器发送